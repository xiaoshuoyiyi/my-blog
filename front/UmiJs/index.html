<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>简介 | JobbbbZhang的博客</title>
    <meta name="description" content="my blog">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.716af2f0.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.43e0b704.js" as="script"><link rel="preload" href="/my-blog/assets/js/2.da7dd8de.js" as="script"><link rel="preload" href="/my-blog/assets/js/3.d30302f3.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.21d23800.js"><link rel="prefetch" href="/my-blog/assets/js/11.3d2a5cd4.js"><link rel="prefetch" href="/my-blog/assets/js/12.c4b14ab7.js"><link rel="prefetch" href="/my-blog/assets/js/13.43b628c6.js"><link rel="prefetch" href="/my-blog/assets/js/14.4185c043.js"><link rel="prefetch" href="/my-blog/assets/js/15.abc90814.js"><link rel="prefetch" href="/my-blog/assets/js/16.734020c3.js"><link rel="prefetch" href="/my-blog/assets/js/17.de8bf93a.js"><link rel="prefetch" href="/my-blog/assets/js/18.33441712.js"><link rel="prefetch" href="/my-blog/assets/js/19.afb8af86.js"><link rel="prefetch" href="/my-blog/assets/js/20.75170fb5.js"><link rel="prefetch" href="/my-blog/assets/js/21.1f8f2e08.js"><link rel="prefetch" href="/my-blog/assets/js/22.c180a62a.js"><link rel="prefetch" href="/my-blog/assets/js/23.fb4f133e.js"><link rel="prefetch" href="/my-blog/assets/js/24.4fb8c784.js"><link rel="prefetch" href="/my-blog/assets/js/25.6e01f1fb.js"><link rel="prefetch" href="/my-blog/assets/js/26.5b8b0d04.js"><link rel="prefetch" href="/my-blog/assets/js/27.37a69a62.js"><link rel="prefetch" href="/my-blog/assets/js/28.ea7998f3.js"><link rel="prefetch" href="/my-blog/assets/js/29.69bf2fdb.js"><link rel="prefetch" href="/my-blog/assets/js/30.25b35296.js"><link rel="prefetch" href="/my-blog/assets/js/4.89f72591.js"><link rel="prefetch" href="/my-blog/assets/js/5.2fae5614.js"><link rel="prefetch" href="/my-blog/assets/js/6.6b705a1d.js"><link rel="prefetch" href="/my-blog/assets/js/7.ccf5f24f.js"><link rel="prefetch" href="/my-blog/assets/js/8.b6dde3c5.js"><link rel="prefetch" href="/my-blog/assets/js/9.1c983b56.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.716af2f0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><img src="/my-blog/img/logo.jpeg" alt="JobbbbZhang的博客" class="logo"> <span class="site-name can-hide">JobbbbZhang的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/front/javascript/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/my-blog/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/my-blog/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/more/css&amp;html/" class="nav-link">
  CSS&amp;HTML
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/more/experience/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/more/markdown/" class="nav-link">
  MarkDown语法
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/more/interview/" class="nav-link">
  面试
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/more/wiki.html" class="nav-link">
  WIKI
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/xiaoshuoyiyi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="联系" class="dropdown-title"><span class="title">联系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="mailto:xiaoshuoyi@163.com" class="nav-link external">
  邮箱
  <!----></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-blog/front/javascript/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/my-blog/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/my-blog/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/more/css&amp;html/" class="nav-link">
  CSS&amp;HTML
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/more/experience/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/more/markdown/" class="nav-link">
  MarkDown语法
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/more/interview/" class="nav-link">
  面试
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/more/wiki.html" class="nav-link">
  WIKI
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/xiaoshuoyiyi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="联系" class="dropdown-title"><span class="title">联系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="mailto:xiaoshuoyi@163.com" class="nav-link external">
  邮箱
  <!----></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>UmiJs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-blog/front/UmiJs/" class="active sidebar-link">UmiJs文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/front/UmiJs/#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/my-blog/front/UmiJs/#快速上手" class="sidebar-link">快速上手</a></li><li class="sidebar-sub-header"><a href="/my-blog/front/UmiJs/#正式开始" class="sidebar-link">正式开始</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信生态相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nodejs</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <h3 id="umi是什么"><a href="#umi是什么" class="header-anchor">#</a> Umi是什么</h3> <p>Umi，中文可发音为<strong>乌米</strong>，是可扩展的企业级前端应用框架。Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。</p> <p>Umi 是蚂蚁金服的底层前端框架，已直接或间接地服务了 3000+ 应用，包括 java、node、H5 无线、离线（Hybrid）应用、纯前端 assets 应用、CMS 应用等。他已经很好地服务了我们的内部用户，同时希望他也能服务好外部用户。</p> <p>它主要具备以下功能：</p> <ul><li>🎉 <strong>可扩展</strong>，Umi 实现了完整的生命周期，并使其插件化，Umi 内部功能也全由插件完成。此外还支持插件和插件集，以满足功能和垂直域的分层需求。</li> <li>📦 <strong>开箱即用</strong>，Umi 内置了路由、构建、部署、测试等，仅需一个依赖即可上手开发。并且还提供针对 React 的集成插件集，内涵丰富的功能，可满足日常 80% 的开发需求。</li> <li>🐠 <strong>企业级</strong>，经蚂蚁内部 3000+ 项目以及阿里、优酷、网易、飞猪、口碑等公司项目的验证，值得信赖。</li> <li>🚀 <strong>大量自研</strong>，包含微前端、组件打包、文档工具、请求库、hooks 库、数据流等，满足日常项目的周边需求。</li> <li>🌴 <strong>完备路由</strong>，同时支持配置式路由和约定式路由，同时保持功能的完备性，比如动态路由、嵌套路由、权限路由等等。</li> <li>🚄 <strong>面向未来</strong>，在满足需求的同时，我们也不会停止对新技术的探索。比如 dll 提速、modern mode、webpack@5、自动化 external、bundler less 等等。</li></ul> <p>umi 是通用方案，适用于现在几乎所有的 web 环境。</p> <h3 id="umi的优势"><a href="#umi的优势" class="header-anchor">#</a> Umi的优势</h3> <p>umi 是一个专注性能的类 next.js 端框架，它的优势是：</p> <ul><li>内置大量的性能优化</li> <li>多端，无缝支持容器和浏览器访问</li> <li>类 webpack 的插件机制</li> <li>针对 <a href="https://ant.design/" target="_blank" rel="noopener noreferrer">antd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 dva 有友好的支持</li></ul> <p>umi 最显著的特点就是「文件即路由」——在 pages 文件夹下新建文件，umi 将自动生成与文件路径对应的路由。在大部分其他前端框架中，路由配置一直是一个很麻烦的事情，而对于多人协作开发的项目，公共的配置文件则可能面临着更多的冲突。</p> <h3 id="umi-的性能"><a href="#umi-的性能" class="header-anchor">#</a> umi 的性能</h3> <p>在项目性能方面 umi 已经帮你做了很多优化，包括构建产物的大小、执行效率、首屏加载、用户体验等方面，但这些优化对于开发者是无感知的，有时候你升级了一下插件版本，整个项目可能就跟着优化了，而不需要你进行其他调整。作者称“你只管写业务代码，我会负责性能，并且随着 umi 的迭代，我保证你的应用会越来越快”。</p> <p>简单的说，umi 做到了开箱即用，对于开发者和前端初学者是非常友好的。</p> <h2 id="快速上手"><a href="#快速上手" class="header-anchor">#</a> 快速上手</h2> <h3 id="环境准备"><a href="#环境准备" class="header-anchor">#</a> 环境准备</h3> <p>首先得有 <a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">node<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，并确保 node 版本是 10.13 或以上。（mac 下推荐使用 <a href="https://github.com/creationix/nvm" target="_blank" rel="noopener noreferrer">nvm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来管理 node 版本）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>node -v
v10.13.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="安装umi"><a href="#安装umi" class="header-anchor">#</a> 安装Umi</h3> <p>后续需要使用 umi 来创建页面 <code>umi g</code> ，并执行多种任务，比如测试 <code>umi test</code> 、打包 <code>umi build</code> 和开发 <code>umi dev</code> 等。为了能直接在命令行中运行这些命令，你需要打开终端/控制台窗口，输入以下命令来全局安装 umi</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -g umi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>推荐使用 <a href="https://yarnpkg.com/" target="_blank" rel="noopener noreferrer">yarn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 代替 npm 来安装 umi ， yarn 会针对部分场景做一些缓存以节省时间，你可以输入以下命令来全局安装 yarn ：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> -g <span class="token function">yarn</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>命令行执行结束后，判断 yarn 是否安装成功：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> -v
<span class="token number">1.9</span>.4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后使用 yarn 安装 umi ：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 等同于 npm install -g umi</span>
$ <span class="token function">yarn</span> global <span class="token function">add</span> umi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>命令行执行结束后，判断 umi 是否安装成功：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ umi -v
<span class="token number">3.0</span>.16
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p><strong>注意</strong>：更多的时候，我们用到的是项目工作空间的 umi，而不是全局的 umi，由于不同版本的 umi 存在一定差异，你需要留意</p></blockquote> <h3 id="创建项目（开始啦）"><a href="#创建项目（开始啦）" class="header-anchor">#</a> 创建项目（开始啦）</h3> <p>首先，创建一个空目录</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> myapp <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> myapp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过 <code>umi g page</code> 来创建页面：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ umi g page home
   create pages/home.js
   create pages/home.css
✔  success
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>也可以手动新建 <code>home.js</code> 文件来创建页面。得到以下的目录结构：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>└── pages
    ├── home.css
    ├── home.js
    └── list.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>这里的 pages 目录是页面所在的目录，umi 约定默认情况下 pages 下所有的 js 文件即路由</p></blockquote> <h3 id="启动开发服务器"><a href="#启动开发服务器" class="header-anchor">#</a> 启动开发服务器</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ umi dev

Compiling
✔ success webpack compiled <span class="token keyword">in</span> 3s 49ms
 DONE  Compiled successfully <span class="token keyword">in</span> 3056ms            <span class="token number">22</span>:37:57


  App running at:
  - Local:   http://localhost:8000/ <span class="token punctuation">(</span>copied to clipboard<span class="token punctuation">)</span>
  - Network: http://192.168.199.195:8000/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>umi 在启动完成后将自动打开浏览器，并访问 http://localhost:8000/ ，你将看到一个404页面，这是开发环境下的 404 页面，因为目前并没有在 pages 下面创建 index.js 。不过没有关系，我们可以通过访问 http://localhost:8000/home 来访问我们创建的 home 页面。</p> <h3 id="脚手架"><a href="#脚手架" class="header-anchor">#</a> 脚手架</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> myapp <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> myapp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建项目大致分为两种：</p> <p>第一种：（这个也是官方文档教程里的）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> create @umijs/umi-app
<span class="token comment"># 或 npm create @umijs/umi-app（要全局安装 @umijs/umi-app ）</span>
<span class="token comment"># 或 npx @umijs/create-umi-app</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这种方式生成的目录结构是这样的：</p> <div align="center"><img src="/my-blog/assets/img/002.01ae0906.png" width="250" heihgt="250" alt="目录结构"></div> <p>第二种：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> create umi
<span class="token comment"># npm create umi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>提示'create-umi-app' 不是内部或外部命令，也不是可运行的程序或批处理文件。</p> <p>需要将 yarn 的 bin 加到环境变量里面，你需要执行 yarn global bin，然后把 global bin 的路径添加到环境变量 PATH 中。</p></blockquote> <p>这种方式生成的目录是这样的：</p> <div align="center"><img src="/my-blog/assets/img/001.0114772b.png" width="250" heihgt="500" alt="目录结构"></div> <p>这两种方式有何差异，以及具体使用的场景，后面会有详细的介绍。</p> <p><strong>安装依赖</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span>
<span class="token comment"># 或npm install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>启动项目</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> start
<span class="token comment"># 或npm run start</span>

<span class="token punctuation">..</span><span class="token punctuation">..</span>
  App running at:
  - Local:   http://localhost:8000 <span class="token punctuation">(</span>copied to clipboard<span class="token punctuation">)</span>
  - Network: http://192.168.12.34:8000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>出现了这个就表示项目启动成功，用浏览器打开：http://localhost:8000就可以查看效果了</p> <p>通过 <code>umi g page</code>来创建页面</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ umi g page home
   create pages/home.js
   create pages/home.css
✔  success
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当然，也可以通过手动创建页面。</p> <p><strong>脚手架创建项目</strong></p> <p>1.安装  @umijs/create-umi-app</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> global <span class="token function">add</span> @umijs/create-umi-app
<span class="token comment"># npm install -g @umijs/create-umi-app</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>@umijs/create-umi-app 主要是用来使用命令行创建 umi 相关的库或者项目。命令中打印 success 说明安装成功，如果你还需要进一步确认，可以执行 <code>create-umi-app -v</code> 来查看 @umijs/create-umi-app 的版本号。</p> <p>2.使用 create-umi-app 新建项目</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 新建目录</span>
$ <span class="token function">mkdir</span> myapp <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> myapp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ create-umi-app
Copy:  .editorconfig
Write: .gitignore
Copy:  .prettierignore
Copy:  .prettierrc
Write: .umirc.ts
Copy:  mock/.gitkeep
Write: package.json
Copy:  README.md
Copy:  src/pages/index.less
Copy:  src/pages/index.tsx
Copy:  tsconfig.json
Copy:  typings.d.ts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如果你的命令行打印的日志如上，说明新建项目完成了，如果有其他的错误，可以确认一下当前目录下是否为空。</p> <p>以上两部也可以合并成一步，在一个空文件夹下面，执行 <code>yarn create @umijs/umi-app</code></p> <p>3.安装依赖</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> 
<span class="token punctuation">..</span>.这个过程需要一些时间
success Saved lockfile.
✨  Done <span class="token keyword">in</span> <span class="token number">170</span>.43s.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>4.启动项目</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> start
$ umi dev
Starting the development server<span class="token punctuation">..</span>.

✔ Webpack
  Compiled successfully <span class="token keyword">in</span> <span class="token number">7</span>.21s

 DONE  Compiled successfully <span class="token keyword">in</span> 7216ms                                  <span class="token number">14</span>:51:34


  App running at:
  - Local:   http://localhost:8000 <span class="token punctuation">(</span>copied to clipboard<span class="token punctuation">)</span>
  - Network: http://192.168.10.6:8000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>用这种方式和上述<strong>方法一</strong>的目录结构是一样的！</p> <h2 id="正式开始"><a href="#正式开始" class="header-anchor">#</a> 正式开始</h2> <h3 id="写在前面"><a href="#写在前面" class="header-anchor">#</a> 写在前面</h3> <p>这个入门教程涉及到了很多 umi 的特性，构建出的应用需要通过 Mock 获取并展示王者荣耀的基本数据，并在不同的视图之间导航。</p> <p>完成本次教程，你将学会：</p> <ul><li>初始化 umi 项目</li> <li>理解 umi 的目录结构及目录约定</li> <li>学会在不同的页面之间导航</li> <li>使用 antd 的布局组件</li> <li>结合 dva 使用 umi</li> <li>如何监听路由事件</li> <li>如何发起 http 请求</li> <li>如何使用和设置 proxy 请求代理</li> <li>如何使用 Mock 数据</li> <li>如何使用别名</li> <li>如何使用动态路由</li> <li>……</li></ul> <p>学到这些知识，如果你有其他前端开发经验，那你应该可以使用 umi，独立构建你自己的应用了。</p> <h3 id="目录结构介绍"><a href="#目录结构介绍" class="header-anchor">#</a> 目录结构介绍</h3> <p>我们之前有试过多种方式创建的项目，但是目录结构只有两种，我们先介绍第一种目录结构：</p> <h4 id="目录结构一"><a href="#目录结构一" class="header-anchor">#</a> 目录结构一</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>├── mock
├── package.json
├── dist
├── public
├── src
│   ├── .umi
		├── layouts/index.tsx
		├── app.ts
│   └── pages
│       ├── index.css
│       └── index.ts
├── .env
└── .umirc.ts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>mock目录</strong></p> <p>存储 mock 文件，此目录下所有 js 和 ts 文件会被解析为 mock 文件。默认开启mock功能，可在.env文件中关闭： MOCK=none；</p> <p><strong>dist 目录</strong></p> <p>执行 <code>umi build</code> 后，产物默认会存放在这里。</p> <p><strong>public 目录</strong></p> <p>此目录下所有文件会被 copy 到输出路径。</p> <p><strong>package.json</strong></p> <p>包含插件和插件集，以 <code>@umijs/preset-</code>、<code>@umijs/plugin-</code>、<code>umi-preset-</code> 和 <code>umi-plugin-</code> 开头的依赖会被自动注册为插件或插件集。</p> <p><strong>.umirc.ts</strong></p> <p>配置文件，包含 umi 内置功能和插件的配置。（它和我们接下来介绍的config/config.ts一样，一般是二选一，当两者同时存在时，优先使用.umirc.ts。）</p> <p><strong>.env</strong></p> <p>环境变量。一般不需要更改，例如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 更改服务启动端口号</span>
<span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">8001</span>

<span class="token comment"># 关闭自动打开浏览器，默认为打开</span>
<span class="token assign-left variable">BROWSER</span><span class="token operator">=</span>none
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>src/.umi/</strong></p> <p>临时文件目录，比如入口文件、路由等，都会被临时生成到这里。<strong>不要提交 .umi 目录到 git 仓库，他们会在 umi dev 和 umi build 时被删除并重新生成。</strong></p> <p><strong>src/layouts/index.tsx</strong></p> <p>约定式路由时的全局布局文件。</p> <p><strong>src/pages 目录</strong></p> <p>约定 pages 下所有的 <code>(j|t)sx?</code> 文件即路由。在 umi 中可以使用约定式路由和配置式路由，在实际项目开发中，我个人偏向于使用，约定式路由。毕竟这是 umi 的主要特性之一。使用约定式路由，意味着不需要维护，可怕的路由配置文件。最常用的有基础路由和动态路由（用于详情页等，需要从 url 取参数的情况）</p> <p><strong>app.ts</strong></p> <p>运行时配置文件，可以在这里扩展运行时的能力，比如修改路由、修改 render 方法等。</p> <p><strong>typings.d.ts配置(使用typescript)</strong></p> <p>根据实际情况进行后缀添加，否则ts会报导入错误</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>declare module <span class="token string">&quot;*.png&quot;</span><span class="token punctuation">;</span>
declare module <span class="token string">&quot;*.jpg&quot;</span><span class="token punctuation">;</span>
declare module <span class="token string">'*.less'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="目录结构二（推荐）"><a href="#目录结构二（推荐）" class="header-anchor">#</a> 目录结构二（推荐）</h4> <p>这种目录结构的项目创建方法，我们之前有介绍</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>├── config
├── mock
├── dist
├── public
├── src
    ├── .umi
		├── assets
		├── components
		├── loacls
		├── layouts
		├── models
		├── services
		├── utils
    ├── pages
        ├── index.less
        └── index.ts
    ├── global.less
    ├── global.ts
    ├── mainfest.json
    ├── service-work.js
    └── typings.d.ts
├── tests
├── package.json
├── .env
└── .umirc.ts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>src/assets</strong></p> <p>存放静态资源，例如图片文件、字体文件等。</p> <p><strong>src/components</strong></p> <p>存放全局通用组件。</p> <p><strong>src/layouts</strong></p> <p>全局布局，如果该文件夹下有index.(js|tsx)会在所有路由外面嵌套一层路由。例如：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> '<span class="token punctuation">.</span><span class="token operator">/</span>pages<span class="token operator">/</span>index<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/users'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> <span class="token string">'./pages/users'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>嵌套之后：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> <span class="token string">'./layouts/index'</span><span class="token punctuation">,</span>
    routes<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        component<span class="token operator">:</span> <span class="token string">'./pages/index'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'/users'</span><span class="token punctuation">,</span>
        component<span class="token operator">:</span> <span class="token string">'./pages/users'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>从组件角度可以简单的理解为如下关系：</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>page</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>page</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>page</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>page</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>只要存在 <code>layouts/index</code>就生效,如果你不需要这个，那你只能将它重命名为别的名字。(可在index文件中进行全局布局，或者根据pathname修改不同路由下的布局)</p></blockquote> <p><strong>src/models</strong></p> <p>全局models,如果有一个以上的页面会使用相同namespace空间内的代码，请将models文件放在此处，不然两个页面之间做交互时，namespace中的代码会产生影响（就是store）</p> <p><strong>src/services</strong></p> <p>存放全局通用请求</p> <p><strong>src/utils</strong></p> <p>存放通用方法</p> <p><strong>tests</strong></p> <p>该文件为测试脚本文件，不会生成路由配置，如果需要使用mock测试，可以在外部mock文件中或者在该文件下创建__mock__文件</p> <h3 id="创建页面"><a href="#创建页面" class="header-anchor">#</a> 创建页面</h3> <p>可以用umi g page about 命令创建页面，这样会自动新建，页面的 js 文件和 css 文件。使用 <code>--typescript --less</code> 来选择性的指定文件类型。例如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ umi g page about --typescript --less
Write: src/pages/about.tsx
Write: src/pages/about.less

$ umi g page <span class="token function">more</span> --typescript --less
Write: src/pages/more.tsx
Write: src/pages/more.less
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后在config/config.ts中配置路由（执行上面那个指令会自动创建，如果没有，就手动创建）</p> <h3 id="配置路由"><a href="#配置路由" class="header-anchor">#</a> 配置路由</h3> <p>在 Umi 中，应用都是<a href="https://en.wikipedia.org/wiki/Single-page_application" target="_blank" rel="noopener noreferrer">单页应用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，页面地址的跳转都是在浏览器端完成的，不会重新请求服务端获取 html，html 只在应用初始化时加载一次。所有页面由不同的组件构成，页面的切换其实就是不同组件的切换，你只需要在配置中把不同的路由路径和对应的组件关联上。</p> <p><strong>path</strong></p> <ul><li>Type: <code>string</code></li></ul> <p>配置可以被 <a href="https://github.com/pillarjs/path-to-regexp/tree/v1.7.0" target="_blank" rel="noopener noreferrer">path-to-regexp@^1.7.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 理解的路径通配符。</p> <p><strong>component</strong></p> <ul><li>Type: <code>string</code></li></ul> <p>配置 location 和 path 匹配后用于渲染的 React 组件路径。可以是绝对路径，也可以是相对路径，如果是相对路径，会从 <code>src/pages</code> 开始找起。</p> <p>如果指向 <code>src</code> 目录的文件，可以用 <code>@</code>，也可以用 <code>../</code>。比如 <code>component: '@/layouts/basic'</code>，或者 <code>component: '../layouts/basic'</code>，推荐用前者。</p> <p><strong>exact</strong></p> <ul><li>Type: <code>boolean</code></li> <li>Default: <code>false</code></li></ul> <p>表示是否严格匹配，即 location 是否和 path 完全对应上。</p> <p>例如：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// url 为 /one/two 时匹配失败</span>
    <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/one'</span><span class="token punctuation">,</span> exact<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token comment">// url 为 /one/two 时匹配成功</span>
    <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/one'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/one'</span><span class="token punctuation">,</span> exact<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>routes</strong></p> <p>配置子路由，通常在需要为多个路径增加 layout 组件时使用。</p> <p>比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'login'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token string">'@/layouts/index'</span><span class="token punctuation">,</span>
      routes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/list'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'list'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/admin'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>然后在 <code>src/layouts/index</code> 中通过 <code>props.children</code> 渲染子路由，</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> padding<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> props<span class="token punctuation">.</span>children <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样，访问 <code>/list</code> 和 <code>/admin</code> 就会带上 <code>src/layouts/index</code> 这个 layout 组件。</p> <p><strong>redirect</strong></p> <ul><li>Type: <code>string</code></li></ul> <p>配置路由跳转。</p> <p>比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> exact<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span> redirect<span class="token operator">:</span> <span class="token string">'/list'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> exact<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/list'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'list'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>访问 <code>/</code> 会跳转到 <code>/list</code>，并由 <code>src/pages/list</code> 文件进行渲染。</p> <p><strong>wrappers</strong></p> <ul><li>Type: <code>string[]</code></li></ul> <p>配置路由的高阶组件封装。</p> <p>比如，可以用于路由级别的权限校验：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/user'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
      wrappers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'@/wrappers/auth'</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'login'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>然后在 <code>src/wrappers/auth</code> 中，</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> isLogin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> props<span class="token punctuation">.</span>children <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这样，访问 <code>/user</code>，就通过 <code>useAuth</code> 做权限校验，如果通过，渲染 <code>src/pages/user</code>，否则跳转到 <code>/login</code>，由 <code>src/pages/login</code> 进行渲染。</p> <p><strong>title</strong></p> <ul><li>Type: <code>string</code></li></ul> <p>配置路由的标题。</p> <p><strong>页面跳转</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> history <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token comment">// 跳转到指定路由</span>
history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 带参数跳转到指定路由</span>
history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/list?a=b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  pathname<span class="token operator">:</span> <span class="token string">'/list'</span><span class="token punctuation">,</span>
  query<span class="token operator">:</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 跳转到上一个路由</span>
history<span class="token punctuation">.</span><span class="token function">goBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>hash 路由</strong></p> <p>详见 <a href="https://umijs.org/zh-CN/config#history" target="_blank" rel="noopener noreferrer">配置#history<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><strong>Link 组件</strong></p> <p>比如：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/users<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Users Page</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后点击 <code>Users Page</code> 就会跳转到 <code>/users</code> 地址。</p> <p>注意：</p> <ul><li><code>Link</code> 只用于单页应用的内部跳转，如果是外部地址跳转请使用 <code>a</code> 标签</li></ul> <p><strong>路由组件参数</strong></p> <p>路由组件可通过 <code>props</code> 获取到以下属性，</p> <ul><li>match，当前路由和 url match 后的对象，包含 <code>params</code>、<code>path</code>、<code>url</code> 和 <code>isExact</code> 属性</li> <li>location，表示应用当前出于哪个位置，包含 <code>pathname</code>、<code>search</code>、<code>query</code> 等属性</li> <li>history，同 <a href="https://umijs.org/zh-CN/api#history" target="_blank" rel="noopener noreferrer">api#history<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 接口</li> <li>route，当前路由配置，包含 <code>path</code>、<code>exact</code>、<code>component</code>、<code>routes</code> 等</li></ul> <p>比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Home Page<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>传递参数给子路由</strong></p> <p>通过 cloneElement，一次就好（Umi 2 时需要两次）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Layout</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span> <span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">cloneElement</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>举个实例</strong></p> <p>如果你想配置在左侧的菜单栏的话，类似于你想达到这种目的：</p> <div align="center"><img src="/my-blog/assets/img/004.be775ba5.png" width="250" heihgt="250" alt="目录结构"></div> <p>那么你需要在src/locals/zh-CN/menu.ts中添加“关于”和“更多”（菜单名称），例如：</p> <div align="center"><img src="/my-blog/assets/img/003.e8b55b96.png" width="500" heihgt="350" alt="目录结构"></div> <p>然后，在config/config.ts文件中配置routes：</p> <div align="center"><img src="/my-blog/assets/img/005.c1e26813.png" width="500" heihgt="400" alt="目录结构"></div> <p>就像welcome那样配置就可以了，然后就达到效果了。</p> <p><strong>config.js中routes属性说明</strong></p> <ul><li>name 和 icon分别代表生成菜单项的文本和图标。</li> <li>hideChildrenInMenu 用于隐藏不需要在菜单中展示的子路由。用法可以查看 分步表单 的配置。</li> <li>hideInMenu 可以在菜单中不展示这个路由，包括子路由。效果可以查看 exception/trigger页面。</li> <li>authority 用来配置这个路由的权限，如果配置了将会验证当前用户的权限，并决定是否展示。</li></ul> <p><strong>Pro 扩展路由配置</strong></p> <ul><li><p>name: 当前路由在菜单和面包屑中的名称，注意这里是国际化配置的 key，具体展示菜单名可以在/src/locales/zh-CN.js 进行配置。</p></li> <li><p>icon: 当前路由在菜单下的图标名。</p></li> <li><p>hideInMenu: 当前路由在菜单中不展现，默认 false。</p></li> <li><p>hideChildrenInMenu: 当前路由的子级在菜单中不展现，默认 false。</p></li> <li><p>hideInBreadcrumb: 当前路由在面包屑中不展现，默认 false。</p></li> <li><p>authority: 允许展示的权限，不设则都可见，详见：权限管理。</p></li></ul> <p><strong>umi中权限路由怎么实现呢？</strong></p> <p>配合路由中的配置，再结合对应的权限组件，来实现，直接看例子吧（注意注释部分）：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/*
 *config.ts中routes的配置，有一个相对路径，这个相对路径的根路径自动指向了src/pages目录。
*/</span>
routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token comment">//这个是登录的页面</span>
      path<span class="token operator">:</span> <span class="token string">'/user'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token string">'../layouts/UserLayout'</span><span class="token punctuation">,</span>
      routes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
          path<span class="token operator">:</span> <span class="token string">'/user/login'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'./user/login'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token comment">//需要登录的页面，全都放在 ../layouts/SecurityLayout，嵌套布局</span>
      path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      <span class="token comment">//留意这个组件，在这个组件里进行了登录权限的判断，当然你也可以按照你的需求去进行设置，</span>
      <span class="token comment">//甚至创建新的权限组件</span>
      component<span class="token operator">:</span> <span class="token string">'../layouts/SecurityLayout'</span><span class="token punctuation">,</span>
      routes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'../layouts/BasicLayout'</span><span class="token punctuation">,</span><span class="token comment">//</span>
          authority<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          routes<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
              redirect<span class="token operator">:</span> <span class="token string">'/welcome'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token comment">//一级菜单</span>
              path<span class="token operator">:</span> <span class="token string">'/welcome'</span><span class="token punctuation">,</span>
              name<span class="token operator">:</span> <span class="token string">'welcome'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'smile'</span><span class="token punctuation">,</span>
              component<span class="token operator">:</span> <span class="token string">'./Welcome'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token comment">//一级菜单</span>
              path<span class="token operator">:</span> <span class="token string">'/admin'</span><span class="token punctuation">,</span>
              name<span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'crown'</span><span class="token punctuation">,</span>
              component<span class="token operator">:</span> <span class="token string">'./Admin'</span><span class="token punctuation">,</span>
              authority<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//配置权限</span>
              routes<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                  <span class="token comment">//二级菜单</span>
                  path<span class="token operator">:</span> <span class="token string">'/admin/sub-page'</span><span class="token punctuation">,</span>
                  name<span class="token operator">:</span> <span class="token string">'sub-page'</span><span class="token punctuation">,</span>
                  icon<span class="token operator">:</span> <span class="token string">'smile'</span><span class="token punctuation">,</span>
                  component<span class="token operator">:</span> <span class="token string">'./Welcome'</span><span class="token punctuation">,</span>
                  authority<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//配置权限</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              name<span class="token operator">:</span> <span class="token string">'list.table-list'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'table'</span><span class="token punctuation">,</span>
              path<span class="token operator">:</span> <span class="token string">'/list'</span><span class="token punctuation">,</span>
              component<span class="token operator">:</span> <span class="token string">'./ListTableList'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              component<span class="token operator">:</span> <span class="token string">'./404'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          component<span class="token operator">:</span> <span class="token string">'./404'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      component<span class="token operator">:</span> <span class="token string">'./404'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><p>总之，非常喜欢umi的权限路由配置，有灵性！真香！</p> <h3 id="页面跳转"><a href="#页面跳转" class="header-anchor">#</a> 页面跳转</h3> <p>页面跳转在路由的介绍中有介绍，这里在简单介绍下；在 umi 里，页面之间跳转有两种方式：声明式和命令式。</p> <p><strong>声明式</strong></p> <p>通过 Link 使用，通常作为 React 组件使用。</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Go to list page</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>命令式</strong></p> <p>通过 history 使用，通常在事件处理中被调用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> history <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">goToListPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>也可以直接从组件的属性中取得 history</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Go to list page</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="dva"><a href="#dva" class="header-anchor">#</a> dva</h3> <p>umi3整合 dva 数据流，在 umi@3 中要使用 dva 的功能很简单，只要使用安装 <code>@umijs/plugin-dva</code> 并在 配置文件中开启 <code>dva</code> 配置。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> <span class="token function">add</span> @umijs/plugin-dva
<span class="token comment"># npm install @umijs/plugin-dva --save</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果你是通过脚手架创建的项目，则不用执行上面的步骤！</p> <p>在config/config.ts中配置就可以了：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
	dva<span class="token operator">:</span> <span class="token punctuation">{</span>
    hmr<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//表示是否启用 dva model 的热更新。</span>
    immer<span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">//表示是否启用 immer 以方便修改 reducer</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>介绍</strong></p> <p>包含以下功能，</p> <ul><li><strong>内置 dva</strong>，默认版本是 <code>^2.6.0-beta.20</code>，如果项目中有依赖，会优先使用项目中依赖的版本。</li> <li><strong>约定是到 model 组织方式</strong>，不用手动注册 model</li> <li><strong>文件名即 namespace</strong>，model 内如果没有声明 namespace，会以文件名作为 namespace</li> <li><strong>内置 dva-loading</strong>，直接 connect <code>loading</code> 字段使用即可</li> <li><strong>支持 immer</strong>，通过配置 <code>immer</code> 开启</li></ul> <p><strong>约定式的 model 组织方式</strong></p> <p>符合以下规则的文件会被认为是 model 文件，</p> <ul><li><code>src/models</code> 下的文件</li> <li><code>src/pages</code> 下，子目录中 models 目录下的文件</li> <li><code>src/pages</code> 下，所有 model.ts 文件</li></ul> <p>比如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>+ src
  + models/a.ts
  + pages
    + foo/models/b.ts
    + bar/model.ts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>其中 <code>a.ts</code>，<code>b.ts</code> 和 <code>model.ts</code> 如果其内容是有效 dva model 写法，则会被认为是 model 文件。</p> <p><strong>dva model 校验</strong></p> <p>默认，上一小节的找到的文件，会做一次校验，校验通过后，才会被添加到最终到 dva model 列表。</p> <p>一些示例，</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 通过</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> <span class="token keyword">namespace</span><span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> reducers<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 通过</span>
<span class="token keyword">const</span> model <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">namespace</span><span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> model<span class="token punctuation">;</span>

<span class="token comment">// 通过，支持 dva-model-extend</span>
<span class="token keyword">import</span> dvaModelExtend <span class="token keyword">from</span> <span class="token string">'dva-model-extend'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">dvaModelExtend</span><span class="token punctuation">(</span>baseModel<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">namespace</span><span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 通过</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token operator">&lt;</span>Model<span class="token operator">&gt;</span><span class="token punctuation">{</span> <span class="token keyword">namespace</span><span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 不通过</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>配置</strong></p> <p>比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  dva<span class="token operator">:</span> <span class="token punctuation">{</span>
    immer<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hmr<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>skipModelValidate</strong></p> <ul><li>Type: <code>boolean</code></li> <li>Default: <code>false</code></li></ul> <p>是否跳过 model 验证。</p> <p><strong>extraModels</strong></p> <ul><li>Type: <code>string[]</code></li> <li>Default: <code>[]</code></li></ul> <p>配置额外到 dva model。</p> <p><strong>immer</strong></p> <ul><li>Type: <code>boolean</code></li> <li>Default: <code>false</code></li></ul> <p>表示是否启用 immer 以方便修改 reducer。</p> <p><strong>hmr</strong></p> <ul><li>Type: <code>boolean</code></li> <li>Default: <code>false</code></li></ul> <p>表示是否启用 dva model 的热更新。</p> <p><strong>umi 接口</strong></p> <p>常用方法可从 umi 直接 import。</p> <p>比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>接口包含，</p> <ul><li>connect</li></ul> <p>绑定数据到组件。</p> <ul><li>getDvaApp</li></ul> <p>获取 dva 实例，即之前的 <code>window.g_app</code>。</p> <ul><li>useDispatch</li></ul> <p>hooks 的方式获取 dispatch，dva 为 2.6.x 时有效。</p> <ul><li>useSelector</li></ul> <p>hooks 的方式获取部分数据，dva 为 2.6.x 时有效。</p> <ul><li>useStore</li></ul> <p>hooks 的方式获取 store，dva 为 2.6.x 时有效。</p> <p><strong>命令</strong></p> <ul><li>umi dva list model</li></ul> <p>查看项目中包含了哪些 model。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ umi dva list model
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>类型</strong></p> <p>通过 umi 导出类型：<code>ConnectRC</code>，<code>ConnectProps</code>，<code>Dispatch</code>，<code>Action</code>，<code>Reducer</code>，<code>ImmerReducer</code>，<code>Effect</code>，<code>Subscription</code>，和所有 <code>model</code> 文件中导出的类型。</p> <p><strong>model 用例</strong></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Effect<span class="token punctuation">,</span> ImmerReducer<span class="token punctuation">,</span> Reducer<span class="token punctuation">,</span> Subscription <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">IndexModelState</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">IndexModelType</span> <span class="token punctuation">{</span>
  <span class="token keyword">namespace</span><span class="token operator">:</span> <span class="token string">'index'</span><span class="token punctuation">;</span>
  state<span class="token operator">:</span> IndexModelState<span class="token punctuation">;</span>
  effects<span class="token operator">:</span> <span class="token punctuation">{</span>
    query<span class="token operator">:</span> Effect<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
    save<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span>IndexModelState<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token comment">// 启用 immer 之后</span>
    <span class="token comment">// save: ImmerReducer&lt;IndexModelState&gt;;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  subscriptions<span class="token operator">:</span> <span class="token punctuation">{</span> setup<span class="token operator">:</span> Subscription <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> IndexModel<span class="token operator">:</span> IndexModelType <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">namespace</span><span class="token operator">:</span> <span class="token string">'index'</span><span class="token punctuation">,</span>

  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  effects<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        <span class="token operator">...</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 启用 immer 之后</span>
    <span class="token comment">// save(state, action) {</span>
    <span class="token comment">//   state.name = action.payload;</span>
    <span class="token comment">// },</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  subscriptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> history <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> pathname <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'query'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> IndexModel<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p><strong>page 用例</strong></p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">FC</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> IndexModelState<span class="token punctuation">,</span> ConnectProps<span class="token punctuation">,</span> Loading<span class="token punctuation">,</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">PageProps</span> <span class="token keyword">extends</span> <span class="token class-name">ConnectProps</span> <span class="token punctuation">{</span>
  index<span class="token operator">:</span> IndexModelState<span class="token punctuation">;</span>
  loading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> IndexPage<span class="token operator">:</span> <span class="token constant">FC</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PageProps</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> = ({ index, dispatch }) =&gt; </span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> index<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token plain-text">;

export default connect(({ index, loading }: { index: IndexModelState; loading: Loading }) =&gt; (</span><span class="token punctuation">{</span>
  index<span class="token punctuation">,</span>
  loading<span class="token operator">:</span> loading<span class="token punctuation">.</span>models<span class="token punctuation">.</span>index<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token plain-text">))(IndexPage);
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>或者</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> IndexModelState<span class="token punctuation">,</span> ConnectRC<span class="token punctuation">,</span> Loading<span class="token punctuation">,</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">PageProps</span> <span class="token punctuation">{</span>
  index<span class="token operator">:</span> IndexModelState<span class="token punctuation">;</span>
  loading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> IndexPage<span class="token operator">:</span> ConnectRC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PageProps</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> = ({ index, dispatch }) =&gt; </span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> index<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token plain-text">;

export default connect(({ index, loading }: { index: IndexModelState; loading: Loading }) =&gt; (</span><span class="token punctuation">{</span>
  index<span class="token punctuation">,</span>
  loading<span class="token operator">:</span> loading<span class="token punctuation">.</span>models<span class="token punctuation">.</span>index<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token plain-text">))(IndexPage);
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>FAQ</strong></p> <ul><li>import { connect 等 API } from umi 无效？</li></ul> <p>检查：</p> <ol><li>dva 配置有没有开启，该插件是配置开启的</li> <li>有没有有效的 dva model，可通过执行 <code>umi dva list model</code> 检查，或者执行 <code>umi g tmp</code> 后查看 <code>src/.umi/plugin-dva/dva.ts</code> 中检查 model 注册情况</li></ol> <p>以及 tsconfig.json 等定义问题，参考 <a href="https://umijs.org/zh-CN/docs/faq#import-from-umi-%E6%B2%A1%E6%9C%89%E5%AE%9A%E4%B9%89%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F" target="_blank" rel="noopener noreferrer">FAQ#import from umi 没有定义怎么办？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>我的 model 写法很动态，不能被识别出来怎么办？</li></ul> <p>配置 <code>dva: { skipModelValidate: true }</code> 关闭 dva 的 model 校验。</p> <h3 id="http请求umi-request"><a href="#http请求umi-request" class="header-anchor">#</a> HTTP请求umi-request</h3> <p>在 umi 项目中并没有规定一定要使用某种 http 请求方式，我们可以根据实际项目，选择自己最熟悉和服务端交互最优的 http 请求方式，一般项目中我们比较常用的就是 fetch 和 axios ，这两者的优缺点比较，可以查阅其他资料，但是无论你选择哪一种，在你需要更换成另一种时，只需要修改几行代码，因为它们在使用上，只有一点点参数结构的差异。</p> <blockquote><p>umi中集成了umi-request插件，所以我就选择了使用umi-request</p></blockquote> <p>废话不多说，直接看例子，在<code>service.ts</code>中这么写</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MoreListParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./data.d'</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getChannelData</span> <span class="token punctuation">(</span><span class="token parameter">params<span class="token operator">?</span><span class="token operator">:</span>MoreListParams</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">api/getChannelData</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        method<span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token operator">...</span>params<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在<code>model.ts</code>这么调用</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Effect<span class="token punctuation">,</span> Reducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getChannelData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./_service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MoreListItem <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./data.d'</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">MoreModelState</span> <span class="token punctuation">{</span>
    listData<span class="token operator">:</span> MoreListItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">MoreModelType</span> <span class="token punctuation">{</span>
    <span class="token keyword">namespace</span><span class="token operator">:</span> <span class="token string">'more'</span><span class="token punctuation">;</span>
    state<span class="token operator">:</span> MoreModelState<span class="token punctuation">;</span>
    effects<span class="token operator">:</span> <span class="token punctuation">{</span>
        getListdata<span class="token operator">:</span> Effect<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
        channelData<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> MoreModel<span class="token operator">:</span> MoreModelType <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">namespace</span><span class="token operator">:</span> <span class="token string">'more'</span><span class="token punctuation">,</span>
    state<span class="token operator">:</span> <span class="token punctuation">{</span>
        listData<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    effects<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">//这里调用请求</span>
        <span class="token operator">*</span><span class="token function">getListdata</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>getChannelData<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'channelData'</span><span class="token punctuation">,</span>
                payload<span class="token operator">:</span> response
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">channelData</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> datas <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token operator">...</span>state<span class="token punctuation">,</span>
                listData<span class="token operator">:</span><span class="token punctuation">[</span><span class="token operator">...</span>datas<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MoreModel<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>很多人可能会疑惑，你那个<code>service.js</code>中应用的那个<code>request</code>是怎么设置的呢？如果你是通过脚手架创建的项目，在你的<code>src/utils</code>的目录下有个，<code>request.ts</code>的文件，其中是umi给你集成好的（当然，你也可以自己修改）：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * request 网络请求工具
 * 更详细的 api 文档: https://github.com/umijs/umi-request
 */</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> extend <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi-request'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> notification <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> codeMessage <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">200</span><span class="token operator">:</span> <span class="token string">'服务器成功返回请求的数据。'</span><span class="token punctuation">,</span>
  <span class="token number">201</span><span class="token operator">:</span> <span class="token string">'新建或修改数据成功。'</span><span class="token punctuation">,</span>
  <span class="token number">202</span><span class="token operator">:</span> <span class="token string">'一个请求已经进入后台排队（异步任务）。'</span><span class="token punctuation">,</span>
  <span class="token number">204</span><span class="token operator">:</span> <span class="token string">'删除数据成功。'</span><span class="token punctuation">,</span>
  <span class="token number">400</span><span class="token operator">:</span> <span class="token string">'发出的请求有错误，服务器没有进行新建或修改数据的操作。'</span><span class="token punctuation">,</span>
  <span class="token number">401</span><span class="token operator">:</span> <span class="token string">'用户没有权限（令牌、用户名、密码错误）。'</span><span class="token punctuation">,</span>
  <span class="token number">403</span><span class="token operator">:</span> <span class="token string">'用户得到授权，但是访问是被禁止的。'</span><span class="token punctuation">,</span>
  <span class="token number">404</span><span class="token operator">:</span> <span class="token string">'发出的请求针对的是不存在的记录，服务器没有进行操作。'</span><span class="token punctuation">,</span>
  <span class="token number">406</span><span class="token operator">:</span> <span class="token string">'请求的格式不可得。'</span><span class="token punctuation">,</span>
  <span class="token number">410</span><span class="token operator">:</span> <span class="token string">'请求的资源被永久删除，且不会再得到的。'</span><span class="token punctuation">,</span>
  <span class="token number">422</span><span class="token operator">:</span> <span class="token string">'当创建一个对象时，发生一个验证错误。'</span><span class="token punctuation">,</span>
  <span class="token number">500</span><span class="token operator">:</span> <span class="token string">'服务器发生错误，请检查服务器。'</span><span class="token punctuation">,</span>
  <span class="token number">502</span><span class="token operator">:</span> <span class="token string">'网关错误。'</span><span class="token punctuation">,</span>
  <span class="token number">503</span><span class="token operator">:</span> <span class="token string">'服务不可用，服务器暂时过载或维护。'</span><span class="token punctuation">,</span>
  <span class="token number">504</span><span class="token operator">:</span> <span class="token string">'网关超时。'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 异常处理程序
 */</span>
<span class="token keyword">const</span> errorHandler <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> Response <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">Response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> response <span class="token punctuation">}</span> <span class="token operator">=</span> error<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> errorText <span class="token operator">=</span> codeMessage<span class="token punctuation">[</span>response<span class="token punctuation">.</span>status<span class="token punctuation">]</span> <span class="token operator">||</span> response<span class="token punctuation">.</span>statusText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> status<span class="token punctuation">,</span> url <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>

    notification<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请求错误 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> errorText<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    notification<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      description<span class="token operator">:</span> <span class="token string">'您的网络发生异常，无法连接服务器'</span><span class="token punctuation">,</span>
      message<span class="token operator">:</span> <span class="token string">'网络异常'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 配置request请求时的默认参数
 */</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  errorHandler<span class="token punctuation">,</span> <span class="token comment">// 默认错误处理</span>
  credentials<span class="token operator">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span> <span class="token comment">// 默认请求是否带上cookie</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> request<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="proxy-请求代理"><a href="#proxy-请求代理" class="header-anchor">#</a> proxy 请求代理</h3> <p>关于proxy的问题，我相信熟悉vue的同学应该都遇到这个，在前后端联调的时候，经常会遇到跨域的问题，这个时候我们的解决办法就是在vue.config.js文件中配置devServer来解决跨域的问题！</p> <p>详细的 proxy 技术可以查阅其他资料，这里简要说明下：之所以会出现跨域访问问题，是因为浏览器的安全策略。所以我们预想是不是有一种方式，能够绕过浏览器的安全策略？</p> <p>那就是先请求一个同源服务器，再由服务器去请求其他的服务器。比如：</p> <ul><li>我们本来是要请求 <code>https://pvp.qq.com</code> 服务器，但是它存在跨域。</li> <li>所以我们先请求了 <code>http://localhost:3000</code> (假设的)，它不存在跨域问题，所以它受理了我们的请求，并且我们可以取得它返回的数据。</li> <li>而由 <code>http://localhost:3000</code> 返回的数据，又是从真实的 <code>https://pvp.qq.com</code> 获取来的，因为服务端不是在浏览器环境，所以就没有浏览器的安全策略问题。</li> <li>因为 <code>http://localhost:3000</code> (假设的)这个服务器，它只是把我们请求的参数，转发到真实服务端，又把真实服务端下发的数据，转发给我们，所以我们称它为代理。</li></ul> <p>umi 提供了 proxy 来处理这个问题。</p> <p><strong>配置proxy.ts</strong></p> <div align="center"><img src="/my-blog/assets/img/011.8bbade9e.png" width="500" heihgt="600" alt="目录结构"></div> <ul><li><p>'/api/' 设置了代理的请求头，比如这里定义了 <code>/api</code> ，当你访问如 <code>/api/abc</code> 这样子的请求，就会触发代理</p></li> <li><p>target 设置代理的目标，即真实的服务器地址</p></li> <li><p>changeOrigin 设置是否跨域请求资源</p></li> <li><p>pathRewrite 表示是否重写请求地址，比如这里的配置，就是把 <code>/api</code> 替换成空字符</p></li></ul> <h3 id="mock-数据"><a href="#mock-数据" class="header-anchor">#</a> Mock 数据</h3> <ol><li><p>在实际项目开发中，我们经常会遇到和服务端同步开发的情况。这时候我们就可以要求服务端先输出接口文档，前后端都根据接口文档输出。在项目交付之前一段时间，再进行前后端连调。</p></li> <li><p>在demo开发学习的过程中，我们也常常遇到需要静态数据的情况</p></li> <li><p>公司网络限制了只能访问部分外网，是的，墙里墙，还是满多的</p></li> <li><p>没有网络的情况，呵呵，想到咖啡店敲个代码，悠哉悠哉，没有公用Wi-Fi，接口都挂了，页面渲染不出来</p></li></ol> <p><strong>umi 中使用 mock</strong></p> <ul><li>约定式 Mock 文件</li></ul> <p>Umi 约定 <code>/mock</code> 文件夹下所有文件为 mock 文件。</p> <p>比如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── mock
    ├── api.ts
    └── users.ts
└── src
    └── pages
        └── index.tsx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>/mock</code> 下的 <code>api.ts</code> 和 <code>users.ts</code> 会被解析为 mock 文件。</p> <ul><li>编写 Mock 文件</li></ul> <p>如果 <code>/mock/api.ts</code> 的内容如下，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 支持值为 Object 和 Array</span>
  <span class="token string">'GET /api/users'</span><span class="token operator">:</span> <span class="token punctuation">{</span> users<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// GET 可忽略</span>
  <span class="token string">'/api/users/1'</span><span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 支持自定义函数，API 参考 express@4</span>
  <span class="token string">'POST /api/users/create'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 添加跨域请求头</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>然后访问 <code>/api/users</code> 就能得到 <code>{ users: [1,2] }</code> 的响应，其他以此类推。</p> <ul><li>配置 Mock</li></ul> <p>详见<a href="https://umijs.org/config#mock" target="_blank" rel="noopener noreferrer">配置#mock<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <ul><li>如何关闭 Mock？</li></ul> <p>可以通过配置关闭，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  mock<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>也可以通过环境变量临时关闭，</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token assign-left variable">MOCK</span><span class="token operator">=</span>none umi dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>mock使用的另一种方式</li></ul> <p>你可以在对应的页面文件夹下，例如下图就是在<code>/pages/more</code>目录下创建了一个<code>_mock.ts</code>的文件，也可以达到mock数据的效果</p> <div align="center"><img src="/my-blog/assets/img/012.6edfed31.png" width="500" heihgt="800" alt="目录结构"></div> <p>代码：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> MoreListItem <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./data.d'</span>
<span class="token keyword">const</span> channelTaleData<span class="token operator">:</span>MoreListItem<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    channelTaleData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span>i<span class="token punctuation">,</span>
        name<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">名字</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        age<span class="token operator">:</span>i<span class="token punctuation">,</span>
        city<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">城市</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">searchChannelData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result<span class="token operator">:</span>MoreListItem<span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        result <span class="token operator">=</span> channelTaleData<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> item<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        result <span class="token operator">=</span> channelTaleData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
    <span class="token string">'GET /api/getChannelData'</span><span class="token operator">:</span><span class="token punctuation">{</span>
        data<span class="token operator">:</span><span class="token punctuation">[</span><span class="token operator">...</span>channelTaleData<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'POST /api/searchChannelData'</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            status<span class="token operator">:</span><span class="token string">'ok'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span><span class="token function">searchChannelData</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>到此这个低配版的umi3的教程就结束了，其中文章中很多内容借鉴了，<a href="https://umijs.org/zh-CN/docs/mock" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，以及一篇语雀大佬的文章https://www.yuque.com/umijs/umi。当然了，本人也在不断的踩坑中，无论是typescript，react，umi3.....还有很多的坑要踩。文中有什么不妥之处，也欢迎广大网友，批评指正，如有需要提供某一模块更详细的教程的，欢迎留言。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/my-blog/front/vue/vue-router/" class="prev">
        vue-router简介及源码剖析
      </a></span> <span class="next"><a href="/my-blog/front/wechat/weapp/">
        微信小程序
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/my-blog/assets/js/app.43e0b704.js" defer></script><script src="/my-blog/assets/js/2.da7dd8de.js" defer></script><script src="/my-blog/assets/js/3.d30302f3.js" defer></script>
  </body>
</html>
